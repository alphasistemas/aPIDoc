# **DocumentaÃ§Ã£o da API**

Para atender as necessidades dos clientes de integrar uma soluÃ§Ã£o de e-commerce ao ERP AlphaInd, foi desenvolvida a API de e-commerce da AlphaSystemas.

Esta Ã© uma API baseada em micro-serviÃ§os e foi construÃ­da utilizando o conceito de REST API, de forma a atender as boas prÃ¡ticas de mercado, tendo ainda uma rota de callback para facilitar a integraÃ§Ã£o. O serviÃ§o oferecido Ã© Serverless.

***

![Arquitetura](https://raw.githubusercontent.com/alphasistemas/aPIDoc/main/images/overview.png)

***
## **ConfiuraÃ§Ã£o de AlphaInd e PDV**

Para que a API funcione corretamente, em conjunto com o AlphaInd e PDV, Ã© necessÃ¡rio que o usuÃ¡rio confiugere o *config.ini* corretamente dos dois sistemas. As configuraÃ§Ãµes que devem ser usadas estÃ£o descritas abaixo:

API=http://api-alpha.alphasystemas.com.br

APIPublish=/subscription/publication

APISignIn=/auth/signIn

DuracaoToken=15000

***

## **Swagger**
A API foi Documentada utilizando o Swagger, um framework de documentaÃ§Ã£o de APIs.

O Swagger, alÃ©m de mostrar os endpoints, permite a realizaÃ§Ã£o de exemplos de testes, retornando as responses associadas ao http status code.

Pode-se acessar a documentaÃ§Ã£o a partir deste link: [DocumentaÃ§Ã£o](/doc)

OBS: Caso tenha problema com CORS, verifique se o Swagger estÃ¡ sendo acessado via https. E caso o erro persista utilize o [Allow CORS: Access-Control-Allow-Origin](https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf/related?hl=en) para habilitar o CORS pelo Chrome.

***
## **ConfiguraÃ§Ãµes de Acesso**

Para usar esta API, Ã© necessÃ¡rio que o usuÃ¡rio esteja autenticado. Para isso, cria-se uma nova conta a partir da rota /auth/singUp ou utiliza-se um usuÃ¡rio administrador provido pela infra. Conseguinte, Ã© necessÃ¡rio que o usuÃ¡rio se autentique pela rota /auth/signIn, que retornarÃ¡ um token de autenticaÃ§Ã£o. Em cada rota da API o token serÃ¡ solicitado como bearer token. O usuÃ¡rio precisarÃ¡ se autenticar novamente toda vez que vencer o prazo de autenticaÃ§Ã£o predefinido. A API sÃ³ funcionarÃ¡ enquanto o usuÃ¡rio estiver usando um token. O tempo de vencimento do token Ã© definido no Config.ini de acordo com o cliente.

***
## **VariÃ¡veis de ambiente**

As variÃ¡veis de ambiente usadas no sistema estÃ£o da seguinte forma.


| ServiÃ§o(S)                                                   | Nome da VariÃ¡vel de Ambiente    | DescriÃ§Ã£o                                    | Valor de Exemplo                                                    | Secret | ObrigatÃ³rio | ProduÃ§Ã£o | Desenvolvimento |
| ------------------------------------------------------------ | ------------------------------- | -------------------------------------------- | --------------------------------------------------------------------| ------ | ----------- | -------- | --------------- |
| AUTH                                                         | IS_FAKE                         | xxxx                                         | true                                                                |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| AUTH, EMAIL                                                  | IS_FAKE_MAIL                    | xxxx                                         | true                                                                |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| AUTH                                                         | MAIL_HOST                       | Host de Email                                | http://api-ecomm.alphasystemas.com.br/email                         |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| AUTH                                                         | MAIL_KEY                        | Key de Email                                 | -                                                                   |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| AUTH, EMAIL                                                  | MAIL_PATH                       | Endpoint do Email                            | /api/email                                                          |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| AUTH                                                         | KEY_PATH                        | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | AUTH_DEFAULT_PERMISSIONS        | PermissÃµes default para esse serviÃ§o         | '{""all"": [""all""]}'                                              |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | DEFAULT_PERMISSIONS             | PermisÃµes default para cada serviÃ§o          | '{""all"": {""all"": [""all""]}}'                                   |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_CONNECTION_TYPE     | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_DISABLED                  | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_DISABLED            | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_URI                 | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_OPTIONS             | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_HOST                | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_PORT                      | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_PORT                | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_USER                | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | MONGO_WRITE_PASSWORD            | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_URI                  | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_CONNECTION_TYPE      | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_OPTIONS              | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_HOST                 | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_PORT                 | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_USER                 | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL                                         | MONGO_READ_PASSWORD             | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | LIMIT_WINDOW_MS                 | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT                                | LIMIT_MAX                       | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOGFRONT, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION | SERVICE_NAME                    | Nome do ServiÃ§o                              | AUTH                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOGFRONT, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION | INSTANCE                        | Nome da Instancia                            | auth                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION               | PORT                            | Porta onde o serviÃ§o vai escutar             | 3000                                                                |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION               | JWT_PUBLIC_KEY                  | JWT RSA PUBLIC KEY                           | -                                                                   |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | CORS_ENABLED                    | CORS Habilitado                              | true                                                                |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | ALLOWED_ORIGIN                  | Origins Permitidas                           | *                                                                   |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | ALLOWED_METHODS                 | MÃ©todos Permitidos                           | GET,HEAD,PUT,PATCH,POST,DELETE                                      |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | ALLOWED_PREFLIGHT_CONTINUE      | Preflight Continue                           | true                                                                |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | ALLOWED_OPTIONS_SUCCESS_STATUS  | Codigo de sucesso de Options                 | 204                                                                 |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_URI | Mongo Server String de ConexÃ£o | mongodb://localhost:27017/?readPreference=primary&appname=MongoDB%20Compass&directConnection=true&ssl=false  |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |             |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_HOST                      | Mongo Server URL                             | mongo.sadfasdf.mongodb.net                                          |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_USER                      | Mongo Server Password                        | password                                                            |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_PASSWORD                  | Mongo Server Password                        | password                                                            |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_WRITE_DATABASE            | Mongo Server Write DB Name                   | write                                                               |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_READ_DATABASE             | Mongo Server Read DB Name                    | read                                                                |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_OPTIONS                   | Mongo Server Options                         | retryWrites=true&w=majority                                         |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, CATALOG, EMAIL, PRODUCT, SALE, USER, SUBSCRIPTION      | MONGO_CONNECTION_TYPE           | Mongo Server Connection Type                 | mongodb+srv                                                         |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, PRODUCT, SALE, USER, SUBSCRIPTION                      | USE_STEP                        | Step para uso na Vercel e sistemas serveless | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| AUTH, PRODUCT, SALE, USER, SUBSCRIPTION                      | STEP_SIZE                       | Tamanho do Step em ms                        | 1000                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOG                                                      | HOST                            | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SIGN_IN                         | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SIGN_IN_SELLER                  | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SIGN_IN_LEGACY                  | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SIGN_UP                         | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | CATALOG_CONFIG                  | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | CATALOG_GROUP                   | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | CATALOG_THEME                   | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | CATALOG_PRODUCT                 | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | PRODUCT_PRODUCT                 | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | POSTAL_CODE_ADDRESS             | xxx                                          | viacep.com.br/ws/                                                   |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SALE_ESTIMATE                   | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SALE_PAYMENT_METHOD             | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | SALE_PAYMENT_CONDITION          | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | PIC_AWS_ACCESS_KEY_ID           | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | PIC_AWS_BUCKET                  | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | PIC_AWS_BUCKET_DIR              | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | PIC_AWS_BUCKET_REGION           | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | ROLE_ID                         | xxx                                          | XXXX                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | FILTER_SALES                    | xxx                                          | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| CATALOGFRONT                                                 | NODE_ENV                        | xxx                                          | test                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| EMAIL                                                        | MAIL_USER                       | UsuÃ¡rio da Caixa de Email                    | user@KingHost.com.br                                                |   ðŸ—¸    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_PASSWORD                   | Senha da Caixa de Email                      | user_password                                                       |   ðŸ—¸    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE                    | ServiÃ§o que hospeda a Caixa de Email         | KingHost                                                            |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE_POOL               | Se o serviÃ§o de Email vai usar Pool          | true                                                                |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE_HOST               | Host do ServiÃ§o que hospeda a Caixa de Email | http://smtpi.kinghost.net/                                          |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE_SECURE             | Se AconexÃ£o Ã© segura com a Caixa de Email    | true                                                                |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE_TLS                | ConfiguraÃ§Ã£o de TLS da Caixa de Email        | '{ "ciphers":"SSLv3", "rejectUnauthorized": false }'                |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SERVICE_PORT               | Porta da ConexÃ£o                             | 465                                                                 |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_SUFIX                      | Sufixo do Email                              | @alphasystemas.com.br                                               |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_TIMEOUT                    | Timeout do Email                             | 100000                                                              |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | MAIL_JITTER                     | Jitter do Email                              | 10000                                                               |   âœ–    |     ðŸ—¸      |    âœ–    |                  |
| EMAIL                                                        | LANGUAGE                        | LÃ­ngua dos Emails                            | pt-br                                                               |   âœ–    |     âœ–      |    ðŸ—¸    |                  |
| PRODUCT                                                      | MSSQL_SSL                       |zzzzzzzzzzzz                                  | true                                                                |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT                                                      | MSSQL_CONNECTION_TIMEOUT        |zzzzzzzzzzzz                                  | 60000                                                               |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT                                                      | MSSQL_REQUEST_TIMEOUT           |zzzzzzzzzzzz                                  | 60000                                                               |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, PRODUCT                                       | STORE_ID                        | Id da Loja                                   | 1                                                                   |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_URI                       | String de conexÃ£o                            | mssql://user:password@*.dns.net:porta/database?encrypt=false&=false |   ðŸ—¸    |     âœ–      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_CONNECTION_TYPE           | MSSQL Server Connection Type                 | mssql                                                               |   ðŸ—¸    |     âœ–      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_OPTIONS                   | MSSQL Server Options                         | {"encrypt": "false","trustServerCertificate": "false"}              |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_READ_DATABASE             | MSSQL Server Read DB Name                    | Alphaind                                                            |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_HOST                      | MSSQL Server URL                             | db_address                                                          |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_PORT                      | MSSQL Server Port                            | db_port                                                             |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_USER                      | MSSQL Server Password                        | user                                                                |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| PRODUCT, SALE, USER, PRODUCT                                 | MSSQL_PASSWORD                  | MSSQL Server Password                        | password                                                            |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| SALE                                                         | AUTH_HOST                       | Host de AutenticaÃ§Ã£o                         | http://api-ecomm.alphasystemas.com.br/auth                          |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| SALE                                                         | PRODUCT_HOST                    | Host de Produto                              | http://api-ecomm.alphasystemas.com.br/product                       |   âœ–    |     ðŸ—¸      |    ðŸ—¸    |                  |
| SALE                                                         | SERVICE_KEY                     | Senha do ServiÃ§o                             | password                                                            |   ðŸ—¸    |     ðŸ—¸      |    ðŸ—¸    |                  |
| USER                                                         | IBGE_URL_PREFIX                 | URL base para a API do IBGE                  | http://servicodados.ibge.gov.br/api/v1/localidades/estados/         |   ðŸ—¸    |     âœ–      |    ðŸ—¸    |                  |
| USER                                                         | IBGE_URL_SUFFIX                 |                                              | /municipios                                                         |   ðŸ—¸    |     âœ–      |    ðŸ—¸    |                  |